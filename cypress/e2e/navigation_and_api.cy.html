// cypress/integration/academicPlanning.spec.js
describe("Consulta de Planificación Académica", () => {
  const professorsData = [
    { id: 1, nombre: "Juan", apellido: "Pérez" },
    { id: 2, nombre: "Luis", apellido: "Pacheco" },
  ];

  const sectionsData = [
    { id: 1, nombre: "Sección A" },
    { id: 2, nombre: "Sección B" },
  ];

  const planningData = [
    {
      id: 1,
      tipo: "Clase",
      titulo: "Introducción a la Matemática",
      fecha: "2024-08-10",
      hora: "10:00",
      profesor_nombre: "Juan",
      profesor_apellido: "Pérez",
      materia_nombre: "Matemáticas",
      seccion_nombre: "101",
      descripcion: "Clase de introducción a las matemáticas básicas.",
      ubicacion: "Aula 07",
    },
    {
      id: 2,
      tipo: "Clase",
      titulo: "Introducción a la Robotica",
      fecha: "2024-08-10",
      hora: "11:00",
      profesor_nombre: "Luis",
      profesor_apellido: "Pacheco",
      materia_nombre: "Robotica",
      seccion_nombre: "102",
      descripcion: "Clase de introducción a la robotica.",
      ubicacion: "Aula 11",
    },
  ];

  beforeEach(() => {
    // Interceptar las respuestas de profesores y secciones utilizando datos de prueba
    cy.intercept("GET", "/profesores", { body: professorsData }).as(
      "fetchProfessors"
    );
    cy.intercept("GET", "/secciones", { body: sectionsData }).as(
      "fetchSections"
    );

    // Simular inicio de sesión
    cy.visit("/login");
    cy.get("input#email").type("juan.perez@ejemplo.com");
    cy.get("input#password").type("password123");
    cy.get("select.form-control").select("director");
    cy.get("#boton_login").click();

    // Asegurarse de que la redirección al dashboard se haya completado
    cy.url().should("include", "/dashboard");

    // Esperar a que el sidebar esté visible
    cy.get(".sidebar").should("be.visible");

    // Navegar a la página de planificación académica
    cy.get(".nav-link").contains("Planes").click();

    // Asegurarse de que la URL cambió a /planning
    cy.url().should("include", "/planning");

    // Esperar que las llamadas a la API de profesores y secciones hayan sido interceptadas
    cy.wait("@fetchProfessors");
    cy.wait("@fetchSections");
  });

  it("Debería mostrar la lista de eventos al seleccionar un profesor", () => {
    // Interceptar la respuesta de planificación académica para un profesor específico
    cy.intercept("GET", "/planificacion/profesor/1", { body: planningData }).as(
      "fetchPlanningProfessor1"
    );

    // Seleccionar un profesor
    cy.get("select#profesor").select("1");
    cy.wait("@fetchPlanningProfessor1");

    // Comprobar que los eventos se muestran en la interfaz
    cy.get(".list-group-item").should("have.length.greaterThan", 0);
  });

  it("Debería mostrar la lista de eventos al seleccionar una sección", () => {
    // Interceptar la respuesta de planificación académica para una sección específica
    cy.intercept("GET", "/planificacion/seccion/1", { body: planningData }).as(
      "fetchPlanningSection1"
    );

    // Seleccionar una sección
    cy.get("select#seccion").select("1");
    cy.wait("@fetchPlanningSection1");

    // Comprobar que los eventos se muestran en la interfaz
    cy.get(".list-group-item").should("have.length.greaterThan", 0);
  });

  it("Debería mostrar los detalles correctos del evento", () => {
    // Interceptar la respuesta de planificación académica para un profesor específico
    cy.intercept("GET", "/planificacion/profesor/1", { body: planningData }).as(
      "fetchPlanningProfessor1"
    );

    // Seleccionar un profesor
    cy.get("select#profesor").select("1");
    cy.wait("@fetchPlanningProfessor1");

    // Comprobar los detalles del primer evento
    cy.get(".list-group-item")
      .first()
      .within(() => {
        cy.get(".fw-bold").should(
          "contain",
          "Clase - Introducción a la Matemática (10 de agosto de 2024 10:00)"
        );
        cy.get("div").eq(1).should("contain", "Profesor: Juan Pérez");
        cy.get("div").eq(2).should("contain", "Materia: Matemáticas");
        cy.get("div").eq(3).should("contain", "Sección: 101");
        cy.get("div")
          .eq(4)
          .should(
            "contain",
            "Descripción: Clase de introducción a las matemáticas básicas."
          );
        cy.get("div").eq(5).should("contain", "Ubicación: Aula 07");
      });
  });
});
